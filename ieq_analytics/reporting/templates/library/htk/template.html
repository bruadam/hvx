<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - H√∏je-Taastrup Kommune</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* PDF-friendly page structure with improved spacing */
        @page {
            margin: 2cm 2cm 3cm 2cm;
        }
        
        .page {
            page-break-after: always;
            min-height: 85vh;
            padding-bottom: 2cm;
        }
        
        .page:last-child {
            page-break-after: auto;
            min-height: auto;
        }
        
        .page-header {
            border-bottom: 2px solid #0066cc;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            color: #0066cc;
            font-size: 1.8em;
            margin: 0;
        }
        
        .page-header .page-subtitle {
            color: #666;
            font-size: 1em;
            margin: 5px 0 0 0;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #0066cc;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            color: #666;
            font-size: 1.2em;
        }
        
        .header .meta {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
        }
        
        .section {
            margin-bottom: 40px;
            page-break-inside: avoid;
            margin-bottom: 30px;
        }
        
        .section-full-page {
            page-break-before: always;
            page-break-after: always;
            min-height: 75vh;
            padding-bottom: 2cm;
        }
        
        /* Improved page break controls */
        .room, .building-summary, .recommendations {
            page-break-inside: avoid;
            margin-bottom: 25px;
        }
        
        .room-compliance-detail {
            page-break-inside: avoid;
        }
        
        .section h2 {
            color: #0066cc;
            border-bottom: 3px solid #0066cc;
            padding-bottom: 10px;
            margin-bottom: 25px;
            margin-top: 35px;
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .section h3 {
            color: #004499;
            border-bottom: 2px solid #004499;
            padding-bottom: 8px;
            margin-top: 30px;
            margin-bottom: 18px;
            font-size: 1.4em;
            font-weight: 500;
        }
        
        .section h4 {
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
            margin-bottom: 12px;
            font-size: 1.2em;
            font-weight: 500;
        }
        
        .section h5 {
            color: #555;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .section h6 {
            color: #666;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 1em;
            font-weight: 500;
        }
        
        /* Chart layouts optimized for PDF pages */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            page-break-inside: avoid;
        }
        
        .charts-grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            page-break-inside: avoid;
        }
        
        .chart {
            margin: 20px 0;
            text-align: center;
            page-break-inside: avoid;
        }
        
        .chart-full-page {
            page-break-before: always;
            page-break-after: always;
            margin: 0;
            text-align: center;
            min-height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .chart img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chart-full-page img {
            max-width: 90%;
            max-height: 70vh;
            object-fit: contain;
        }
        
        .chart-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }
        
        .chart-caption {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
        
        .data-quality-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .data-quality-table th,
        .data-quality-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .data-quality-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .data-quality-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .building {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .building-header {
            background-color: #0066cc;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .building-header h3 {
            margin: 0;
            color: white;
        }
        
        .room {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #0066cc;
        }
        
        .room-header {
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .room-header h4 {
            margin: 0;
            color: #0066cc;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 4px;
            margin: 10px 0;
        }
        
        .metric-card {
            background-color: white;
            border-radius: 4px;
            padding: 2px 2px;
            border: 1px solid #ddd;
            text-align: center;
            position: relative;
        }
        
        .metric-value {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 2px;
            line-height: 1.1;
        }
        
        .metric-value.good { color: #28a745; }
        .metric-value.warning { color: #ffc107; }
        .metric-value.danger { color: #dc3545; }
        .metric-value.neutral { color: #6c757d; }
        
        .metric-label {
            color: #666;
            font-size: 0.75em;
            line-height: 1.2;
            margin-top: 2px;
        }
        
        /* Add gauge-like styling */
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 4px 4px 0 0;
        }
        
        .metric-card .good::before { background-color: #28a745; }
        .metric-card .warning::before { background-color: #ffc107; }
        .metric-card .danger::before { background-color: #dc3545; }
        .metric-card .neutral::before { background-color: #6c757d; }
        
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .criteria-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
        }
        
        .criteria-card h4 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .criteria-card p {
            margin: 8px 0;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .criteria-card strong {
            color: #212529;
        }
        
        .recommendations {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .recommendations h4 {
            color: #856404;
            margin-top: 0;
        }
        
        .recommendation-list {
            list-style-type: none;
            padding: 0;
        }
        
        .recommendation-list li {
            background-color: white;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #ffc107;
        }
        
        .priority-high { border-color: #dc3545 !important; }
        .priority-medium { border-color: #ffc107 !important; }
        .priority-low { border-color: #28a745 !important; }
        
        /* Observations styling - similar to recommendations but with different colors */
        .observations {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .observations h4 {
            color: #1565c0;
            margin-top: 0;
        }
        
        .observation-list {
            list-style-type: none;
            padding: 0;
        }
        
        .observation-list li {
            background-color: white;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #2196f3;
        }
        
        /* Room Summary Styles */
        .room-summary {
            background-color: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #0066cc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .room-summary-header h5 {
            margin: 0 0 10px 0;
            color: #0066cc;
            font-size: 1.1em;
        }
        
        .summary-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-recommendations {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }
        
        .recommendation-item {
            margin-bottom: 8px;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .recommendation-item:last-child {
            margin-bottom: 0;
        }
        
        /* Priority levels for solar shading */
        .priority-high {
            color: #dc3545;
            font-weight: bold;
        }
        
        .priority-medium {
            color: #fd7e14;
            font-weight: bold;
        }
        
        .priority-low {
            color: #ffc107;
            font-weight: bold;
        }
        
        .priority-none {
            color: #28a745;
            font-weight: bold;
        }
        
        .priority-unknown {
            color: #6c757d;
            font-style: italic;
        }
        
        /* Compliance Analysis Styles */
        .compliance-analysis {
            margin-top: 20px;
        }
        
        .room-compliance-detail {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #28a745;
        }
        
        .room-compliance-detail h5 {
            color: #0066cc;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .room-compliance-detail h6 {
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1em;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }
        
        .period-summary {
            margin-bottom: 20px;
        }
        
        .period-list {
            list-style-type: none;
            padding: 0;
            margin: 10px 0;
        }
        
        .period-list li {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        
        .period-list li:last-child {
            border-bottom: none;
        }
        
        .compliance-tables {
            margin: 20px 0;
        }
        
        .compliance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 0.85em;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .compliance-table th {
            background-color: #0066cc;
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .compliance-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }
        
        .compliance-table td:first-child {
            text-align: left;
            font-weight: 500;
            background-color: #f8f9fa;
        }
        
        .compliance-table small {
            display: block;
            color: #6c757d;
            font-size: 0.75em;
            margin-top: 2px;
        }
        
        /* Enhanced compliance color coding */
        .compliance-green {
            background-color: #d4edda !important;
            color: #155724 !important;
            font-weight: bold;
        }
        
        .compliance-yellow {
            background-color: #fff3cd !important;
            color: #856404 !important;
            font-weight: bold;
        }
        
        .compliance-red {
            background-color: #f8d7da !important;
            color: #721c24 !important;
            font-weight: bold;
        }
        
        .compliance-summary {
            margin-top: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ffc107;
        }
        
        .compliance-summary ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .compliance-summary li {
            margin-bottom: 5px;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .summary-label {
            font-weight: 500;
            color: #333;
            font-size: 0.9em;
        }
        
        .summary-value {
            font-weight: bold;
            font-size: 0.9em;
        }
        
        /* Table color coding for low compliance */
        .periods-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .periods-table th,
        .periods-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .periods-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .periods-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        /* Color coding for table cells based on compliance levels */
        .periods-table .good { color: #28a745; font-weight: bold; }
        .periods-table .warning { color: #ffc107; font-weight: bold; }
        .periods-table .danger { color: #dc3545; font-weight: bold; }
        .periods-table .neutral { color: #6c757d; }
        
        /* Enhanced color coding for very low compliance */
        .periods-table .very-low { 
            color: #dc3545; 
            background-color: #f8d7da; 
            font-weight: bold; 
        }
        
        .periods-table .low { 
            color: #856404; 
            background-color: #fff3cd; 
            font-weight: bold; 
        }
        
        .footer {
            margin-top: 60px;
            text-align: center;
            font-size: 0.9em;
            color: #666;
            border-top: 1px solid #e0e0e0;
            padding-top: 20px;
            page-break-inside: avoid;
            margin-bottom: 20px;
        }
        
        @media print {
            .section {
                page-break-inside: avoid;
            }
            
            .building {
                page-break-inside: avoid;
            }
            
            .chart {
                page-break-inside: avoid;
            }
        }
        
        .toc {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 40px;
        }
        
        .toc h2 {
            margin-top: 0;
        }
        
        .toc ul {
            list-style-type: none;
            padding-left: 20px;
        }
        
        .toc li {
            margin-bottom: 5px;
        }
        
        .toc a {
            text-decoration: none;
            color: #0066cc;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .toc .no-link {
            color: #333;
            font-weight: normal;
        }
        
        /* Performance ranking and categorization styles */
        .performance-summary {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .performance-ranking {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .rank-badge, .category-badge, .recommendation-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .rank-badge {
            background-color: #6c757d;
            color: white;
        }
        
        .category-excellent { background-color: #28a745; color: white; }
        .category-good { background-color: #6f42c1; color: white; }
        .category-fair { background-color: #ffc107; color: black; }
        .category-poor { background-color: #fd7e14; color: white; }
        .category-critical { background-color: #dc3545; color: white; }
        
        .rec-critical_co2 { background-color: #dc3545; color: white; }
        .rec-ventilation_improvement { background-color: #fd7e14; color: white; }
        .rec-temperature_control { background-color: #ffc107; color: black; }
        .rec-minor_improvements { background-color: #17a2b8; color: white; }
        .rec-well_performing { background-color: #28a745; color: white; }
        
        /* Ventilation grade badges */
        .ventilation-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            font-weight: 600;
            margin-left: 5px;
        }
        .vent-A { background-color: #28a745; color: white; }
        .vent-B { background-color: #6f42c1; color: white; }
        .vent-C { background-color: #ffc107; color: black; }
        .vent-D { background-color: #fd7e14; color: white; }
        .vent-E { background-color: #dc3545; color: white; }
        .vent-F { background-color: #6c757d; color: white; }
        
        .performance-score {
            font-size: 0.95em;
            color: #666;
            font-weight: 500;
        }
        
        /* Ventilation analysis styles */
        .ventilation-status h5 {
            margin-top: 15px;
            margin-bottom: 8px;
            color: #0066cc;
        }
        
        .ventilation-status p {
            margin: 0;
            line-height: 1.5;
            color: #555;
        }
        
        /* Room section organization styles */
        .room > h4 {
            border-top: 2px solid #e9ecef;
            padding-top: 20px;
            margin-top: 30px;
        }
        
        .room > h4:first-of-type {
            border-top: none;
            padding-top: 0;
            margin-top: 20px;
        }
        
        /* Detailed compliance analysis spacing */
        .period-summary {
            background-color: #f8f9fa;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
        }
        
        .period-list {
            margin: 10px 0 0 0;
            padding-left: 20px;
        }
        
        .period-list li {
            margin-bottom: 5px;
        }
        
        /* Methodology section styles */
        .methodology-section {
            font-size: 0.95em;
            line-height: 1.6;
        }
        
        .methodology-intro {
            background-color: #f8f9fa;
            border: 2px solid #0066cc;
            padding: 15px 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
        
        .explanation-block {
            margin-bottom: 40px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 30px;
        }
        
        .explanation-block:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .explanation-block h3 {
            color: #0066cc;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .explanation-block ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .explanation-block li {
            margin-bottom: 8px;
        }
        
        .explanation-block strong {
            color: #333;
        }
        
        .explanation-block em {
            color: #666;
            font-style: italic;
        }
        
        /* Building Summary Styles */
        .building-summary {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
            border: 2px solid #0066cc;
        }
        
        .building-summary h4 {
            color: #0066cc;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .summary-overview {
            margin-bottom: 25px;
            padding: 15px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .summary-overview p {
            margin: 0;
            color: #333;
            font-size: 1.05em;
        }
        
        .key-findings, .building-recommendations {
            margin-bottom: 20px;
        }
        
        .key-findings h5, .building-recommendations h5 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
        }
        
        .findings-list, .recommendations-list {
            margin: 0;
            padding-left: 20px;
        }
        
        .findings-list li, .recommendations-list li {
            margin-bottom: 10px;
            color: #555;
            line-height: 1.5;
        }
        
        .findings-list li::marker {
            color: #0066cc;
        }
        
        .recommendations-list li::marker {
            color: #198754;
        }
    </style>
</head>
<body>
    <!-- Title Page -->
    <div class="page">
        <div class="header">
            <h1>{{ report_title }}</h1>
            <div class="subtitle">Indeklima Analyse</div>
            <div class="meta">
                <strong>Genereret:</strong> {{ generation_date }}<br>
                <strong>Periode:</strong> {{ analysis_period }}<br>
                <strong>Bygninger:</strong> {{ building_count }}<br>
                <strong>Forfatter:</strong> {{ author }}
            </div>
        </div>
    </div>

    <!-- Table of Contents Page -->
    {% if include_toc %}
    <div class="page">
        <div class="page-header">
            <h1>Indholdsfortegnelse</h1>
        </div>
        <div class="toc">
            <ul>
                <li><a href="#executive-summary">1. Sammenfatning</a></li>
                <li><a href="#data-quality">2. Datakvalitetsvurdering</a></li>
                <li><a href="#building-analysis">3. Bygningsanalyse</a>
                    <ul>
                        {% for building in buildings %}
                        <li><a href="#building-{{ building.id }}">3.{{ loop.index }} {{ building.friendly_name or building.name }}</a></li>
                        {% endfor %}
                    </ul>
                </li>
                <li><span class="no-link">4. Oversigt Diagrammer</span></li>
                <li><a href="#recommendations">5. Anbefalinger</a></li>
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Executive Summary Page -->
    <div class="page">
        <div class="page-header">
            <h1>1. Sammenfatning</h1>
            <div class="page-subtitle">Overordnet performance og n√∏gletal</div>
        </div>
        
        <div class="section" id="executive-summary">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value {{ overall_performance.class }}">{{ overall_performance.value }}%</div>
                    <div class="metric-label">Samlet Performance</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ co2_compliance_1000.class }}">{{ co2_compliance_1000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;1000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ co2_compliance_2000.class }}">{{ co2_compliance_2000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;2000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ temperature_compliance.class }}">{{ temperature_compliance.value }}%</div>
                    <div class="metric-label">Temperatur Overholdelse</div>
                </div>
            </div>

        <div class="chart">
            <div class="chart-title">Bygningssammenligning</div>
            <img src="{{ charts.building_comparison }}" alt="Bygningssammenligning">
            <div class="chart-caption">Performance sammenligning mellem bygninger</div>
        </div>

        <p>{{ executive_summary_text }}</p>
    </div>

    <!-- Data Quality Assessment Page -->
    <div class="page">
        <div class="page-header">
            <h1>2. Datakvalitetsvurdering</h1>
            <div class="page-subtitle">Vurdering af datagrundlag og p√•lidelighed</div>
        </div>
        
        <div class="section" id="data-quality">
            <p>Nedenst√•ende tabel viser datakvaliteten for hver lokation. Dette er vigtigt for at forst√• p√•lideligheden af analyseresultaterne.</p>
            
            <table class="data-quality-table">
                <thead>
                    <tr>
                        <th>Bygning</th>
                        <th>Datakomplethed (%)</th>
                        <th>Manglende Perioder</th>
                        <th>Kvalitetsscore</th>
                    </tr>
                </thead>
                <tbody>
                    {% for building in data_quality %}
                    <tr>
                        <td>{{ building.friendly_name or building.name }}</td>
                        <td>{{ "%.1f"|format(building.completeness) }}%</td>
                        <td>{{ building.missing_periods }}</td>
                        <td class="{{ building.quality_class }}">{{ building.quality_score }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Analysis Criteria Page -->
    <div class="page">
        <div class="page-header">
            <h1>2.1 Analysekriterier</h1>
            <div class="page-subtitle">Brugerbaserede regler og gr√¶nsev√¶rdier</div>
        </div>
        
        <div class="section" id="analysis-criteria">
            <h3>Temperatur Kriterier</h3>
            <div class="criteria-grid">
                <div class="criteria-card">
                    <h4>Komfort Zone (20-26¬∞C)</h4>
                    <p><strong>Beskrivelse:</strong> Procentdel af timer hvor temperaturen er mellem 20¬∞C og 26¬∞C</p>
                    <p><strong>Anvendelse:</strong> Hele √•ret, √•bningstid og uden for √•bningstid</p>
                    <p><strong>Form√•l:</strong> Vurderer grundl√¶ggende termisk komfort</p>
                </div>
                <div class="criteria-card">
                    <h4>Sommer Gr√¶nse (&lt;26¬∞C)</h4>
                    <p><strong>Beskrivelse:</strong> Procentdel af timer hvor temperaturen er under 26¬∞C</p>
                    <p><strong>Anvendelse:</strong> Sommerperiode (juni-august), alle dagsperioder</p>
                    <p><strong>Form√•l:</strong> Forebygger overophedning i varme m√•neder</p>
                </div>
                <div class="criteria-card">
                    <h4>Udvidet Gr√¶nse (&lt;27¬∞C)</h4>
                    <p><strong>Beskrivelse:</strong> Procentdel af timer hvor temperaturen er under 27¬∞C</p>
                    <p><strong>Anvendelse:</strong> Hele √•ret og sommerm√•neder, √•bningstid</p>
                    <p><strong>Form√•l:</strong> Identifikation af alvorlig overophedning</p>
                </div>
            </div>

            <h3>CO‚ÇÇ Kriterier</h3>
            <div class="criteria-grid">
                <div class="criteria-card">
                    <h4>Grundstandard (&lt;1000 ppm)</h4>
                    <p><strong>Beskrivelse:</strong> Procentdel af timer hvor CO‚ÇÇ er under 1000 ppm</p>
                    <p><strong>Anvendelse:</strong> Hele √•ret, alle perioder</p>
                    <p><strong>Form√•l:</strong> Standard luftkvalitet og ventilationseffektivitet</p>
                </div>
                <div class="criteria-card">
                    <h4>Acceptabel Gr√¶nse (&lt;2000 ppm)</h4>
                    <p><strong>Beskrivelse:</strong> Procentdel af timer hvor CO‚ÇÇ er under 2000 ppm</p>
                    <p><strong>Anvendelse:</strong> Hele √•ret, b√•de √•bningstid og uden for √•bningstid</p>
                    <p><strong>Form√•l:</strong> Minimumskrav for acceptabel luftkvalitet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Completeness Chart Page -->
    <div class="chart-full-page">
        <div class="chart-title">Datakomplethed Over Tid</div>
        <img src="{{ charts.data_completeness }}" alt="Datakomplethed">
        <div class="chart-caption">Oversigt over datakomplethed for hver bygning over analyseperioden</div>
    </div>

    <!-- Building Analysis Section -->
    <div class="section" id="building-analysis">
        {% for building in buildings %}
        <!-- Building Overview Page -->
        <div class="page">
            <div class="page-header">
                <h1>3.{{ loop.index }} {{ building.friendly_name or building.name }}</h1>
                <div class="page-subtitle">Bygningsspecifik analyse og performance</div>
            </div>

            <!-- Overall Building Performance with properly calculated metrics -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value {{ building.co2_compliance_1000.class }}">{{ building.co2_compliance_1000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;1000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ building.co2_compliance_2000.class }}">{{ building.co2_compliance_2000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;2000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_above_26 > 10 else 'warning' if building.temp_above_26 > 5 else 'good' }}">{{ "%.1f"|format(building.temp_above_26) }}%</div>
                    <div class="metric-label">Temp. &gt;26¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_above_27 > 5 else 'warning' if building.temp_above_27 > 1 else 'good' }}">{{ "%.1f"|format(building.temp_above_27) }}%</div>
                    <div class="metric-label">Temp. &gt;27¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_below_20 > 15 else 'warning' if building.temp_below_20 > 5 else 'good' }}">{{ "%.1f"|format(building.temp_below_20) }}%</div>
                    <div class="metric-label">Temp. &lt;20¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ building.room_count }}</div>
                    <div class="metric-label">Antal Rum</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Data Completeness Chart Page -->
    <div class="section" id="building-analysis">
        <h2>3. Bygningsanalyse</h2>
        
        {% for building in buildings %}
        <div class="building" id="building-{{ building.id }}">
            <div class="building-header">
                <h3>3.{{ loop.index }} {{ building.friendly_name or building.name }}</h3>
            </div>

            <!-- Top Issues -->
            <!-- <h4>Rum med Flest Problemer</h4>
            <div class="chart">
                <div class="chart-title">Top 10 Rum med CO‚ÇÇ og Temperatur Problemer</div>
                <img src="{{ building.charts.top_issues }}" alt="Top Issues - {{ building.friendly_name or building.name }}">
                <div class="chart-caption">Rum ranket efter antal overskridelser af gr√¶nsev√¶rdier</div>
            </div> -->

            <!-- Overall Building Performance with separated CO2 compliance -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value {{ building.co2_compliance_1000.class }}">{{ building.co2_compliance_1000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;1000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ building.co2_compliance_2000.class }}">{{ building.co2_compliance_2000.value }}%</div>
                    <div class="metric-label">CO‚ÇÇ &lt;2000ppm</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_above_26 > 10 else 'warning' if building.temp_above_26 > 5 else 'good' }}">{{ "%.1f"|format(building.temp_above_26) }}%</div>
                    <div class="metric-label">Temp. &gt;26¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_above_27 > 5 else 'warning' if building.temp_above_27 > 1 else 'good' }}">{{ "%.1f"|format(building.temp_above_27) }}%</div>
                    <div class="metric-label">Temp. &gt;27¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value {{ 'danger' if building.temp_below_20 > 15 else 'warning' if building.temp_below_20 > 5 else 'good' }}">{{ "%.1f"|format(building.temp_below_20) }}%</div>
                    <div class="metric-label">Temp. &lt;20¬∞C</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ building.room_count }}</div>
                    <div class="metric-label">Antal Rum</div>
                </div>
            </div>

            <!-- Building Basic Statistics -->
            {% if building.basic_statistics %}
            <h4>Bygningens Grundl√¶ggende Statistik</h4>
            <div class="metrics-grid">
                {% if building.basic_statistics.temperature %}
                <div class="metric-card">
                    <div class="metric-value">{{ "%.1f"|format(building.basic_statistics.temperature.mean) }}¬∞C</div>
                    <div class="metric-label">Gns. Temperatur</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ "%.1f"|format(building.basic_statistics.temperature.min) }} - {{ "%.1f"|format(building.basic_statistics.temperature.max) }}¬∞C</div>
                    <div class="metric-label">Temperatur Interval</div>
                </div>
                {% endif %}
                {% if building.basic_statistics.co2 %}
                <div class="metric-card">
                    <div class="metric-value">{{ "%.0f"|format(building.basic_statistics.co2.mean) }} ppm</div>
                    <div class="metric-label">Gns. CO‚ÇÇ</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">{{ "%.0f"|format(building.basic_statistics.co2.min) }} - {{ "%.0f"|format(building.basic_statistics.co2.max) }} ppm</div>
                    <div class="metric-label">CO‚ÇÇ Interval</div>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Building Summary -->
            {% if building.summary %}
            <div class="building-summary">
                <h4>üìã Vigtige Observationer for {{ building.friendly_name or building.name }}</h4>
                <div class="summary-overview">
                    <p><strong>Bygningen omfatter {{ building.summary.total_rooms }} rum, hvoraf {{ building.summary.rooms_with_issues }} har identificerede problemer.</strong></p>
                </div>
                
                {% if building.summary.key_findings %}
                <div class="key-findings">
                    <h5>üîç Vigtige Observationer:</h5>
                    <ul class="findings-list">
                        {% for finding in building.summary.key_findings %}
                        <li>{{ finding }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if building.summary.recommendations %}
                <div class="building-recommendations">
                    <h5>üí° Anbefalinger:</h5>
                    <ul class="recommendations-list">
                        {% for recommendation in building.summary.recommendations %}
                        <li>{{ recommendation }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}
        <!-- Building Top Issues Chart - Full Page -->
        <!-- <div class="chart-full-page">
            <div class="chart-title">Top 10 Rum med CO‚ÇÇ og Temperatur Problemer - {{ building.friendly_name or building.name }}</div>
            <img src="{{ building.charts.top_issues }}" alt="Top Issues - {{ building.friendly_name or building.name }}">
            <div class="chart-caption">Rum ranket efter antal overskridelser af gr√¶nsev√¶rdier</div>
        </div> -->

        <!-- Comprehensive Room Analysis - Performance, Compliance, Graphs & Tables -->
        {% for room in building.rooms %}
        <div class="page">
            <div class="page-header">
                <h1>{{ building.friendly_name or building.name }} - {{ room.friendly_name or room.name }}</h1>
                <div class="page-subtitle">Rumspecifik analyse og trends</div>
                
                <!-- Performance Ranking and Category -->
                {% if room.performance_rank %}
                <div class="performance-summary">
                    <div class="performance-ranking">
                        <span class="rank-badge rank-{{ room.performance_category }}">
                            Placering: {{ room.performance_rank }}/{{ room.performance_rank_total }}
                        </span>
                        <span class="category-badge category-{{ room.performance_category }}">
                            {{ room.performance_category|title }}
                        </span>
                        <span class="recommendation-badge rec-{{ room.recommendation_category }}">
                            {% if room.recommendation_category == "critical_co2" %}Kritisk CO‚ÇÇ
                            {% elif room.recommendation_category == "ventilation_improvement" %}Ventilationsforbedring
                            {% elif room.recommendation_category == "temperature_control" %}Temperaturkontrol  
                            {% elif room.recommendation_category == "minor_improvements" %}Mindre forbedringer
                            {% else %}Velfungerende{% endif %}
                        </span>
                        {% if room.ventilation and room.ventilation.ventilation_grade and room.ventilation.periods_analyzed > 0 and room.ventilation.ach_mean > 0 and room.ventilation.ventilation_status != "Not calculated" and room.ventilation.ventilation_status != "No data available" and room.ventilation.ventilation_status != "Invalid data" %}
                        <span class="ventilation-badge vent-{{ room.ventilation.ventilation_grade }}">
                            Ventilation: {{ room.ventilation.ventilation_grade }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="performance-score">
                        Performance Score: {{ "%.1f"|format(room.performance_score) }}/100
                    </div>
                </div>
                {% endif %}
            </div>

            <div class="room" id="room-{{ room.id }}">
                <!-- Room Performance Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value {{ room.co2_1000_class }}">{{ "%.1f"|format(room.co2_1000_compliance) }}%</div>
                        <div class="metric-label">CO‚ÇÇ &lt;1000ppm (Bes√¶ttelse)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value {{ room.co2_2000_class }}">{{ "%.1f"|format(room.co2_2000_compliance) }}%</div>
                        <div class="metric-label">CO‚ÇÇ &lt;2000ppm (Bes√¶ttelse)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value {{ room.temp_performance.class }}">{{ room.temp_performance.value }}%</div>
                        <div class="metric-label">Temp. 20-26¬∞C (Bes√¶ttelse)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value {{ 'danger' if room.metrics.temp_above_27_occupancy > 5 else 'warning' if room.metrics.temp_above_27_occupancy > 1 else 'good' }}">
                            {{ "%.1f"|format(room.metrics.temp_above_27_occupancy) }}%
                        </div>
                        <div class="metric-label">Temp. &gt;27¬∞C (Bes√¶ttelse)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value {{ 'danger' if room.metrics.temp_above_26_occupancy > 10 else 'warning' if room.metrics.temp_above_26_occupancy > 5 else 'good' }}">
                            {{ "%.1f"|format(room.metrics.temp_above_26_occupancy) }}%
                        </div>
                        <div class="metric-label">Temp. &gt;26¬∞C (Bes√¶ttelse)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value {{ 'danger' if room.metrics.temp_below_20_occupancy > 15 else 'warning' if room.metrics.temp_below_20_occupancy > 5 else 'good' }}">
                            {{ "%.1f"|format(room.metrics.temp_below_20_occupancy) }}%
                        </div>
                        <div class="metric-label">Temp. &lt;20¬∞C (Bes√¶ttelse)</div>
                    </div>
                    {% if room.ventilation and room.ventilation.periods_analyzed > 0 and room.ventilation.ach_mean > 0 and room.ventilation.ventilation_status != "Not calculated" and room.ventilation.ventilation_status != "No data available" and room.ventilation.ventilation_status != "Invalid data" %}
                    <div class="metric-card">
                        <div class="metric-value {{ 'good' if room.ventilation.ach_mean >= 2.0 else 'warning' if room.ventilation.ach_mean >= 1.0 else 'danger' }}">
                            {{ "%.2f"|format(room.ventilation.ach_mean) }}
                            <small>({{ room.ventilation.confidence }})</small>
                            {% if room.ventilation.ventilation_grade %}
                            <span class="ventilation-badge vent-{{ room.ventilation.ventilation_grade }}" style="margin-left: 5px; font-size: 0.8em;">{{ room.ventilation.ventilation_grade }}</span>
                            {% endif %}
                        </div>
                        <div class="metric-label">ACH (Luftskifte/time)</div>
                    </div>
                    {% endif %}
                    <div class="metric-card">
                        <div class="metric-value {{ room.data_quality.class }}">{{ room.data_quality.value }}%</div>
                        <div class="metric-label">Datakvalitet</div>
                    </div>
                </div>

                <!-- Room Basic Statistics -->
                {% if room.basic_statistics %}
                <h4>Grundl√¶ggende Statistik for {{ room.friendly_name or room.name }}</h4>
                <div class="metrics-grid">
                    {% if room.basic_statistics.temperature %}
                    <div class="metric-card">
                        <div class="metric-value">{{ "%.1f"|format(room.basic_statistics.temperature.mean) }}¬∞C</div>
                        <div class="metric-label">Gns. Temperatur</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ "%.1f"|format(room.basic_statistics.temperature.std) }}¬∞C</div>
                        <div class="metric-label">Std. Afvigelse</div>
                    </div>
                    {% endif %}
                    {% if room.basic_statistics.co2 %}
                    <div class="metric-card">
                        <div class="metric-value">{{ "%.0f"|format(room.basic_statistics.co2.mean) }} ppm</div>
                        <div class="metric-label">Gns. CO‚ÇÇ</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ "%.0f"|format(room.basic_statistics.co2.std) }} ppm</div>
                        <div class="metric-label">Std. Afvigelse</div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}

                <!-- Daily Periods Performance with color coding -->
                <h4>Performance per Dagsperiode</h4>
                <table class="periods-table">
                    <thead>
                        <tr>
                            <th>Periode</th>
                            <th>CO‚ÇÇ &lt;1000ppm (%)</th>
                            <th>CO‚ÇÇ &lt;2000ppm (%)</th>
                            <th>Temp. Overholdelse (%)</th>
                            <th>Gns. CO‚ÇÇ (ppm)</th>
                            <th>Gns. Temperatur (¬∞C)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for period in room.daily_periods %}
                        <tr>
                            <td>{{ period.name }}</td>
                            <td class="{{ period.co2_1000_class }}">{{ period.co2_1000_compliance }}%</td>
                            <td class="{{ period.co2_2000_class }}">{{ period.co2_2000_compliance }}%</td>
                            <td class="{{ period.temp_class }}">{{ period.temp_compliance }}%</td>
                            <td class="{{ period.avg_co2_class }}">{{ period.avg_co2 }}</td>
                            <td class="{{ period.avg_temp_class }}">{{ period.avg_temp }}¬∞C</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Seasonal Performance with color coding -->
                <h4>Performance per √Örstid</h4>
                <table class="periods-table">
                    <thead>
                        <tr>
                            <th>√Örstid</th>
                            <th>CO‚ÇÇ &lt;1000ppm (%)</th>
                            <th>CO‚ÇÇ &lt;2000ppm (%)</th>
                            <th>Temp. Overholdelse (%)</th>
                            <th>Gns. CO‚ÇÇ (ppm)</th>
                            <th>Gns. Temperatur (¬∞C)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for season in room.seasons %}
                        <tr>
                            <td>{{ season.name }}</td>
                            <td class="{{ season.co2_1000_class }}">{{ season.co2_1000_compliance }}%</td>
                            <td class="{{ season.co2_2000_class }}">{{ season.co2_2000_compliance }}%</td>
                            <td class="{{ season.temp_class }}">{{ season.temp_compliance }}%</td>
                            <td class="{{ season.avg_co2_class }}">{{ season.avg_co2 }}</td>
                            <td class="{{ season.avg_temp_class }}">{{ season.avg_temp }}¬∞C</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <!-- Comprehensive Ventilation Analysis -->
                {% if room.ventilation and room.ventilation.periods_analyzed > 0 and room.ventilation.ach_mean > 0 and room.ventilation.ventilation_status != "Not calculated" and room.ventilation.ventilation_status != "No data available" and room.ventilation.ventilation_status != "Invalid data" %}
                <h4>Ventilationsanalyse</h4>
                <div class="room-compliance-detail">
                    <!-- Primary Ventilation Metrics -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.ach_mean >= 2.0 else 'warning' if room.ventilation.ach_mean >= 1.0 else 'danger' }}">
                                {{ "%.2f"|format(room.ventilation.ach_mean) }}
                            </div>
                            <div class="metric-label">Gennemsnitlig ACH</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">{{ "%.2f"|format(room.ventilation.ach_std) }}</div>
                            <div class="metric-label">Standardafvigelse</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.ventilation_grade in ['A', 'B'] else 'warning' if room.ventilation.ventilation_grade in ['C', 'D'] else 'danger' }}">
                                {{ room.ventilation.ventilation_grade }}
                            </div>
                            <div class="metric-label">Ventilationskarakter</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.confidence_score >= 0.8 else 'warning' if room.ventilation.confidence_score >= 0.6 else 'danger' }}">
                                {{ "%.1f"|format(room.ventilation.confidence_score * 100) }}%
                            </div>
                            <div class="metric-label">P√•lidelighedscore</div>
                        </div>
                    </div>
                    
                    <!-- Efficiency Metrics -->
                    {% if room.ventilation.efficiency_metrics %}
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.air_renewal_efficiency >= 75 else 'warning' if room.ventilation.air_renewal_efficiency >= 50 else 'danger' }}">
                                {{ "%.1f"|format(room.ventilation.air_renewal_efficiency) }}%
                            </div>
                            <div class="metric-label">Luftfornyelseseffektivitet</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.pollutant_removal_capacity >= 75 else 'warning' if room.ventilation.pollutant_removal_capacity >= 50 else 'danger' }}">
                                {{ "%.1f"|format(room.ventilation.pollutant_removal_capacity) }}%
                            </div>
                            <div class="metric-label">Forureningsfjernelseskapacitet</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value {{ 'good' if room.ventilation.occupancy_support_level >= 75 else 'warning' if room.ventilation.occupancy_support_level >= 50 else 'danger' }}">
                                {{ "%.1f"|format(room.ventilation.occupancy_support_level) }}%
                            </div>
                            <div class="metric-label">Bes√¶ttelsesunderst√∏ttelse</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">{{ room.ventilation.consistency_rating }}</div>
                            <div class="metric-label">Konsistensvurdering</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- Status and Grade Description -->
                    <div class="ventilation-status">
                        <h5>Status: {{ room.ventilation.ventilation_status }}</h5>
                        {% if room.ventilation.grade_description %}
                        <p><strong>Karakter {{ room.ventilation.ventilation_grade }}:</strong> {{ room.ventilation.grade_description }}</p>
                        {% endif %}
                        
                        <!-- Detailed Recommendations -->
                        {% if room.ventilation.detailed_recommendation %}
                        <div style="margin-top: 15px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #0066cc; border-radius: 0 4px 4px 0;">
                            <h6 style="color: #0066cc; margin: 0 0 8px 0; font-size: 14px;">üìã Detaljerede anbefalinger:</h6>
                            <div style="white-space: pre-wrap; line-height: 1.5; font-size: 13px;">{{ room.ventilation.detailed_recommendation }}</div>
                        </div>
                        {% else %}
                        <p>{{ room.ventilation.recommendation }}</p>
                        {% endif %}
                        
                        <!-- Analysis Details -->
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            <strong>Analyserede perioder:</strong> {{ room.ventilation.periods_analyzed }} | 
                            <strong>P√•lidelighedsniveau:</strong> {{ room.ventilation.confidence }}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Detailed Compliance Analysis by Periods -->
                {% if room.basic_statistics and room.basic_statistics.compliance_analysis %}
                <h4>Detaljeret Overholdelsesanalyse</h4>
                <div class="room-compliance-detail">
                    <!-- Period Analysis Summary -->
                    <div class="period-summary">
                        <h6>Analyserede Perioder:</h6>
                        <ul class="period-list">
                            {% for period_name, period_info in room.basic_statistics.compliance_analysis.period_analysis.items() %}
                            <li><strong>{{ period_info.description }}:</strong> {{ period_info.total_hours }} timer</li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- Temperature Compliance Tables -->
                    <div class="compliance-tables">
                        <h6>Temperatur Overholdelse:</h6>
                        <table class="compliance-table">
                            <thead>
                                <tr>
                                    <th>Periode</th>
                                    <th>&lt;20¬∞C</th>
                                    <th>20-26¬∞C (Komfort)</th>
                                    <th>21-24¬∞C (Optimal)</th>
                                    <th>&gt;26¬∞C</th>
                                    <th>&gt;27¬∞C</th>
                                    <th>Gennemsnit</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for period_name, temp_data in room.basic_statistics.compliance_analysis.temperature_compliance.items() %}
                                <tr>
                                    <td>{{ room.basic_statistics.compliance_analysis.period_analysis[period_name].description.split(':')[0] }}</td>
                                    <td class="{{ 'compliance-red' if temp_data.below_20_percentage > 10 else 'compliance-green' }}">
                                        {{ "%.1f"|format(temp_data.below_20_percentage) }}%
                                        <small>({{ temp_data.below_20_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-green' if temp_data.comfort_zone_20_26_percentage > 80 else 'compliance-yellow' if temp_data.comfort_zone_20_26_percentage > 60 else 'compliance-red' }}">
                                        {{ "%.1f"|format(temp_data.comfort_zone_20_26_percentage) }}%
                                        <small>({{ temp_data.comfort_zone_20_26_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-green' if temp_data.optimal_zone_21_24_percentage > 60 else 'compliance-yellow' if temp_data.optimal_zone_21_24_percentage > 40 else 'compliance-red' }}">
                                        {{ "%.1f"|format(temp_data.optimal_zone_21_24_percentage) }}%
                                        <small>({{ temp_data.optimal_zone_21_24_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-red' if temp_data.above_26_percentage > 10 else 'compliance-yellow' if temp_data.above_26_percentage > 5 else 'compliance-green' }}">
                                        {{ "%.1f"|format(temp_data.above_26_percentage) }}%
                                        <small>({{ temp_data.above_26_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-red' if temp_data.above_27_percentage > 5 else 'compliance-yellow' if temp_data.above_27_percentage > 1 else 'compliance-green' }}">
                                        {{ "%.1f"|format(temp_data.above_27_percentage) }}%
                                        <small>({{ temp_data.above_27_hours }}t)</small>
                                    </td>
                                    <td>{{ temp_data.mean_temperature }}¬∞C</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        
                        <!-- CO2 Compliance Table -->
                        <h6>CO‚ÇÇ Overholdelse:</h6>
                        <table class="compliance-table">
                            <thead>
                                <tr>
                                    <th>Periode</th>
                                    <th>&lt;1000ppm</th>
                                    <th>&lt;2000ppm</th>
                                    <th>&gt;2000ppm</th>
                                    <th>Gennemsnit</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for period_name, co2_data in room.basic_statistics.compliance_analysis.co2_compliance.items() %}
                                <tr>
                                    <td>{{ room.basic_statistics.compliance_analysis.period_analysis[period_name].description.split(':')[0] }}</td>
                                    <td class="{{ 'compliance-green' if co2_data.below_1000_percentage > 80 else 'compliance-yellow' if co2_data.below_1000_percentage > 60 else 'compliance-red' }}">
                                        {{ "%.1f"|format(co2_data.below_1000_percentage) }}%
                                        <small>({{ co2_data.below_1000_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-green' if co2_data.below_2000_percentage > 95 else 'compliance-yellow' if co2_data.below_2000_percentage > 85 else 'compliance-red' }}">
                                        {{ "%.1f"|format(co2_data.below_2000_percentage) }}%
                                        <small>({{ co2_data.below_2000_hours }}t)</small>
                                    </td>
                                    <td class="{{ 'compliance-red' if co2_data.above_2000_percentage > 1 else 'compliance-green' }}">
                                        {{ "%.1f"|format(co2_data.above_2000_percentage) }}%
                                        <small>({{ co2_data.above_2000_hours }}t)</small>
                                    </td>
                                    <td>{{ co2_data.mean_co2 }}ppm</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Key Findings and Recommendations -->
                    {% if room.basic_statistics.compliance_analysis.summary.key_findings %}
                    <div class="compliance-summary">
                        <h6>Vigtige Observationer:</h6>
                        <ul>
                            {% for finding in room.basic_statistics.compliance_analysis.summary.key_findings %}
                            <li>{{ finding }}</li>
                            {% endfor %}
                        </ul>
                        
                        <h6>Anbefalinger:</h6>
                        <ul>
                            {% for recommendation in room.basic_statistics.compliance_analysis.summary.recommendations %}
                            <li>{{ recommendation }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Room Charts - Full Pages -->
        <div class="chart-full-page">
            <div class="chart-title">Tidsbaseret Analyse - {{ room.friendly_name or room.name }}</div>
            <img src="{{ room.charts.time_series_analysis }}" alt="Time Series Analysis - {{ room.friendly_name or room.name }}">
            <div class="chart-caption">Temperatur og CO‚ÇÇ v√¶rdier over tid med markering af weekender og ferier</div>
        </div>

        <div class="chart-full-page">
            <div class="chart-title">Daglig Distribution - {{ room.friendly_name or room.name }}</div>
            <img src="{{ room.charts.daily_distribution }}" alt="Daily Distribution - {{ room.friendly_name or room.name }}">
            <div class="chart-caption">Gennemsnitlig dag med √∏vre og nedre gr√¶nser</div>
        </div>

        <!-- NEW: Temperature Heatmap -->
        <div class="chart-full-page">
            <div class="chart-title">Temperatur Heatmap - {{ room.friendly_name or room.name }}</div>
            <img src="{{ room.charts.temperature_heatmap }}" alt="Temperature Heatmap - {{ room.friendly_name or room.name }}">
            <div class="chart-caption">Temperaturfordeling over m√•neder og timer p√• dagen</div>
        </div>

        <!-- NEW: CO2 Heatmap -->
        <div class="chart-full-page">
            <div class="chart-title">CO‚ÇÇ Heatmap - {{ room.friendly_name or room.name }}</div>
            <img src="{{ room.charts.co2_heatmap }}" alt="CO2 Heatmap - {{ room.friendly_name or room.name }}">
            <div class="chart-caption">CO‚ÇÇ-fordeling over m√•neder og timer p√• dagen</div>
        </div>

        <!-- NEW: Detailed Compliance Analysis -->
        <div class="chart-full-page">
            <div class="chart-title">Detaljeret Overholdelsesanalyse - {{ room.friendly_name or room.name }}</div>
            <img src="{{ room.charts.detailed_compliance }}" alt="Detailed Compliance Analysis - {{ room.friendly_name or room.name }}">
            <div class="chart-caption">Opdelt analyse af temperatur og CO‚ÇÇ gr√¶nseoverskridelser med periodesammendrag</div>
        </div>
        {% endfor %}

        <!-- NEW: Room Compliance Comparison for Building -->
        <div class="chart-full-page">
            <div class="chart-title">Sammenligning af Rumoverholdelse - {{ building.friendly_name or building.name }}</div>
            <img src="{{ building.charts.room_compliance_comparison }}" alt="Room Compliance Comparison - {{ building.friendly_name or building.name }}">
            <div class="chart-caption">Overholdelse af gr√¶nsev√¶rdier per rum, sorteret fra v√¶rst til bedst</div>
        </div>

        <!-- NEW: Climate Correlation Charts -->
        {% if building.charts.climate_correlation_heatmap %}
        <div class="chart-full-page">
            <div class="chart-title">Klima Korrelation - {{ building.friendly_name or building.name }}</div>
            <img src="{{ building.charts.climate_correlation_heatmap }}" alt="Climate Correlation Heatmap - {{ building.friendly_name or building.name }}">
            <div class="chart-caption">Korrelation mellem udend√∏rs klimaforhold og temperatur</div>
        </div>
        {% endif %}

        {% if building.charts.solar_sensitivity %}
        <div class="chart-full-page">
            <div class="chart-title">Sol-sensitivitet og Afsk√¶rmningsanbefalinger - {{ building.friendly_name or building.name }}</div>
            <img src="{{ building.charts.solar_sensitivity }}" alt="Solar Sensitivity - {{ building.friendly_name or building.name }}">
            <div class="chart-caption">Analyse af solindstr√•lingens p√•virkning p√• temperatur og anbefalinger for solafsk√¶rmning</div>
        </div>
        {% endif %}

        {% if building.charts.seasonal_climate_correlation %}
        <div class="chart-full-page">
            <div class="chart-title">S√¶sonm√¶ssig Klima Korrelation - {{ building.friendly_name or building.name }}</div>
            <img src="{{ building.charts.seasonal_climate_correlation }}" alt="Seasonal Climate Correlation - {{ building.friendly_name or building.name }}">
            <div class="chart-caption">S√¶sonm√¶ssige variationer i korrelation mellem udend√∏rs klima og indend√∏rs temperatur</div>
        </div>
        {% endif %}

        <!-- Building Recommendations -->
        <div class="page">
            <div class="page-header">
                <h1>Anbefalinger for {{ building.friendly_name or building.name }}</h1>
                <div class="page-subtitle">Bygningsspecifikke forbedringer</div>
            </div>
            
            <div class="recommendations">
                <ul class="recommendation-list">
                    {% for rec in building.recommendations %}
                    <li class="priority-{{ rec.priority }}">
                        <strong>{{ rec.title }}</strong><br>
                        {{ rec.description }}
                        {% if rec.estimated_cost %}
                        <br><em>Estimeret omkostning: {{ rec.estimated_cost }} DKK</em>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Overall Recommendations Pages -->
    <div class="page">
        <div class="page-header">
            <h1>5. Samlede Anbefalinger</h1>
            <div class="page-subtitle">Prioriterede forbedringer p√• tv√¶rs af bygninger</div>
        </div>
        
        <div class="section" id="recommendations">
            <div class="recommendations">
                <h4>H√∏jprioritets Anbefalinger</h4>
                <ul class="recommendation-list">
                    {% for rec in high_priority_recommendations %}
                    <li class="priority-high">
                        <strong>{{ rec.title }}</strong><br>
                        {{ rec.description }}
                        <br><em>P√•virkning: {{ rec.impact }}, Estimeret ROI: {{ rec.roi }}</em>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="recommendations">
                <h4>Implementeringsplan</h4>
                <ol>
                    {% for phase in implementation_phases %}
                    <li>
                        <strong>{{ phase.name }}</strong> ({{ phase.timeframe }})<br>
                        {{ phase.description }}
                        <br><em>Estimeret omkostning: {{ phase.cost }} DKK</em>
                    </li>
                    {% endfor %}
                </ol>
            </div>
        </div>
    </div>

    <!-- Recommendations Charts -->
    <div class="chart-full-page">
        <div class="chart-title">Prioritetsmatrix for Forbedringer</div>
        <img src="{{ charts.priority_matrix }}" alt="Priority Matrix">
        <div class="chart-caption">Anbefalinger plottet efter p√•virkning vs. indsats</div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>
            <strong>IEQ Analytics - H√∏je-Taastrup Kommune</strong><br>
            Genereret {{ generation_date }} | Version {{ template_version }}
        </p>
    </div>
</body>
</html>
        </div>

        <div class="recommendations">
            <h4>Implementeringsplan</h4>
            <ol>
                {% for phase in implementation_phases %}
                <li>
                    <strong>{{ phase.name }}</strong> ({{ phase.timeframe }})<br>
                    {{ phase.description }}
                    <br><em>Estimeret omkostning: {{ phase.cost }} DKK</em>
                </li>
                {% endfor %}
            </ol>
        </div>
    </div>

    <!-- Analysis Methodology Explanations -->
    <div class="page">
        <div class="page-header">
            <h1>üìö Analyse Metodologi</h1>
            <div class="page-subtitle">Forklaring af analysemetoder og logik</div>
        </div>
        
        <div class="methodology-section">
            <div class="methodology-intro">
                <p>Dette afsnit forklarer de forskellige analytiske tilgange og algoritmer, der anvendes i rapporten for at sikre transparens og forst√•else af resultaterne.</p>
            </div>
            
            <div class="explanations-container">
                {% for key, explanation in analysis_explanations.items() %}
                <div class="explanation-block">
                    {{ explanation|safe }}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>
            <strong>IEQ Analytics - H√∏je-Taastrup Kommune</strong><br>
            Genereret {{ generation_date }} | Version {{ template_version }}
        </p>
    </div>
</body>
</html>
